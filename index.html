<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HPCCSS Room Capacity Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f7fafc;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background-color: #a0aec0;
            border-radius: 4px;
        }
        .floor-plan-container {
            position: relative;
            max-width: 100%;
            height: auto;
            margin: 0 auto;
        }
        .floor-plan {
            width: 100%;
            height: auto;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .room-marker {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid white;
            transition: all 0.2s ease-in-out;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.5);
        }
        .room-marker:hover {
            transform: translate(-50%, -50%) scale(1.2);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.8), 0 0 10px var(--marker-color);
            z-index: 10;
        }
        .room-marker-blink {
            animation: pulse-border 1.5s infinite;
        }
        @keyframes pulse-border {
            0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 255, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
        }
        .view-toggle-button {
            color: #4B5563;
            background-color: #E5E7EB;
            border: none;
            padding: 8px 12px;
            font-weight: 600;
            font-size: 0.875rem;
            line-height: 1.25rem;
            border-radius: 0.75rem;
            transition-duration: 200ms;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .view-toggle-button:hover {
            background-color: #D1D5DB;
        }
        .view-toggle-button.active {
            color: #ffffff;
            background-color: #4F46E5;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        .view-toggle-button.active:hover {
             background-color: #4338CA;
        }
    </style>
    <script>
        const TRANSLATIONS = {
            'en': {
                'title_list': 'HPCCSS Room Capacity Dashboard',
                'title_floor': 'HPCCSS Room Capacity Dashboard',
                'subtitle_list': '',
                'subtitle_floor': '',
                'refresh_data': 'Refresh Data',
                'loading': 'Loading...',
                'fetching_data': 'Fetching real-time data...',
                'error_loading': 'Error loading data! T^T',
                'sort_by': 'Sort By:',
                'option_default': 'Default',
                'option_percentage': '% Full',
                'option_people': 'People',
                'direction_asc': 'Ascending',
                'direction_desc': 'Descending',
                'floor': 'Floor',
                'room_id_label': 'Room ID',
                'capacity_label': 'Capacity',
                'people_label': 'people',
                'error_api': 'API Error! T^T',
                'floor_view_mode': 'Floor View',
                'list_view_mode': 'List View',
                'select_floor': 'Select Floor:',
                'room_details': 'Room Details',
                'no_room_selected': 'Click on a room marker on the map to see its details.',
                'not_found': 'Room data not found.',
                'current_occupancy': 'Current Occupancy'
            },
            'zh': {
                'title_list': '實時房間佔用監控',
                'title_floor': '互動佔用監控',
                'subtitle_list': '實時房間容量狀態。點擊刷新即可更新。',
                'subtitle_floor': '選擇樓層平面圖並點擊房間以查看實時容量。',
                'refresh_data': '刷新數據',
                'loading': '載入中...',
                'fetching_data': '正在獲取實時數據...',
                'error_loading': '載入數據錯誤。請在 console 檢查。',
                'sort_by': '排序方式：',
                'option_default': '默認順序',
                'option_percentage': '佔用百分比',
                'option_people': '人數',
                'direction_asc': '升序',
                'direction_desc': '降序',
                'floor': '樓層',
                'room_id_label': '房間編號',
                'capacity_label': '容量',
                'people_label': '人',
                'error_api': '從 API 獲取數據錯誤。',
                'floor_view_mode': '樓層視圖',
                'list_view_mode': '列表視圖',
                'select_floor': '選擇樓層：',
                'room_details': '房間詳情',
                'no_room_selected': '點擊地圖上的房間標記以查看其詳情。',
                'not_found': '找不到房間數據。',
                'current_occupancy': '當前佔用人數'
            }
        };

        // va,playground,cover,chinese academy,library,201-5,105,phychembiostemlabs,106,107,pta booth
        
        const ROOM_CONFIG = [
            { room_id: "LG", name: "Training Room Alpha", name_zh: "操場", max_capacity: 40, floor_label: "LG/F", x: 15, y: 20 },
            { room_id: "G01", name: "VA Room", name_zh: "視藝室", max_capacity: 40, floor_label: "G/F", x: 15, y: 20 },
            { room_id: "101", name: "1A", name_zh: "1A", max_capacity: 40, floor_label: "1/F", x: 15, y: 20 },
            { room_id: "102", name: "1B", name_zh: "1B", max_capacity: 40, floor_label: "1/F", x: 40, y: 15 },
            { room_id: "103", name: "1C", name_zh: "1C", max_capacity: 40, floor_label: "1/F", x: 70, y: 25 },
            { room_id: "104", name: "1D", name_zh: "1D", max_capacity: 40, floor_label: "1/F", x: 85, y: 55 },
            { room_id: "105", name: "1E", name_zh: "1E", max_capacity: 40, floor_label: "1/F", x: 30, y: 60 },
            { room_id: "201", name: "2A", name_zh: "2A", max_capacity: 40, floor_label: "2/F", x: 30, y: 60 }
        ];

        const FLOOR_PLANS_RAW = [
            {
                key: 'LG/F',
                label_en: 'Lower-Ground Floor (LG/F)',
                label_zh: '低層地下 (LG/F)',
                image_url: 'https://placehold.co/800x600/add8e6/2c3e50?text=First+Floor+Plan+(LG/F)',
            },
            {
                key: 'G/F',
                label_en: 'Ground Floor (G/F)',
                label_zh: '地下 (LG/F)',
                image_url: 'https://placehold.co/800x600/add8e6/2c3e50?text=First+Floor+Plan+(G/F)',
            },
            {
                key: '1/F',
                label_en: '1st Floor (1/F)',
                label_zh: '地下 (1/F)',
                image_url: 'https://placehold.co/800x600/add8e6/2c3e50?text=First+Floor+Plan+(1/F)',
            },
            {
                key: '2/F',
                label_en: '2nd Floor (2/F)',
                label_zh: '一樓 (2/F)',
                image_url: 'https://placehold.co/800x600/add8e6/2c3e50?text=First+Floor+Plan+(2/F)',
            },
        ];

        const API_URL = 'https://haydenalt.github.io/capacitydashboard/data.json';

        let currentMergedRoomData = new Map();
        let currentRoomDataArray = [];
        let currentSortKey = 'api_order';
        let currentSortDirection = 'asc';
        let currentLang = 'en';
        let currentView = 'list';
        let currentFloor = '1/F';
        let FLOOR_PLANS = {};

        function translate(key) {
            return TRANSLATIONS[currentLang][key] || key;
        }

        function getBarColor(percentage) {
            if (percentage < 50) return '#10B981';
            if (percentage <= 80) return '#F59E0B';
            return '#EF4444';
        }

        function getMarkerColor(percentage) {
            if (percentage < 50) return 'rgb(16, 185, 129)';
            if (percentage <= 80) return 'rgb(245, 158, 11)';
            return 'rgb(239, 68, 68)';
        }

        function getCardColorClass(percentage) {
            if (percentage === 0) {
                return 'bg-green-50 border-green-400';
            } else if (percentage < 50) {
                return 'bg-green-100 border-green-500';
            } else if (percentage <= 80) {
                return 'bg-amber-100 border-amber-500';
            } else {
                return 'bg-red-100 border-red-500';
            }
        }

        async function fetchOccupancyData() {
            const response = await fetch(API_URL);

            if (!response.ok) {
                const text = await response.text();
                throw new Error(`HTTP error! status: ${response.status} - ${text}`);
            }

            try {
                const apiOccupancy = await response.json();
                if (!Array.isArray(apiOccupancy)) {
                    throw new Error("API response is not an array.");
                }
                return apiOccupancy;
            } catch (error) {
                throw new Error(`JSON Parsing Error: ${error.message}`);
            }
        }

        function mergeData(occupancyData) {
            const newRoomDataMap = new Map();
            const newRoomDataArray = [];
            const configMap = new Map(ROOM_CONFIG.map(config => [config.room_id, config]));

            occupancyData.forEach((occupancy, index) => {
                const config = configMap.get(occupancy.room_id);

                if (config) {
                    const current_occupancy = occupancy.current_occupancy;
                    const percentage = config.max_capacity > 0
                        ? Math.min(100, Math.round((current_occupancy / config.max_capacity) * 100))
                        : 0;

                    const merged = {
                        ...config,
                        current_occupancy,
                        percentage,
                        color: getMarkerColor(percentage),
                        colorClass: getCardColorClass(percentage),
                        api_index: index
                    };
                    newRoomDataMap.set(occupancy.room_id, merged);
                    newRoomDataArray.push(merged);
                }
            });
            currentMergedRoomData = newRoomDataMap;
            currentRoomDataArray = newRoomDataArray;

            if (currentView === 'list') {
                sortRooms(currentSortKey);
            } else {
                renderFloor(currentFloor);
            }
        }

        function renderRooms(rooms) {
            const listContainer = document.getElementById('room-list');
            listContainer.innerHTML = '';

            const roomNameKey = currentLang === 'zh' ? 'name_zh' : 'name';
            const t = TRANSLATIONS[currentLang];

            rooms.forEach(room => {
                const listItem = document.createElement('div');
                listItem.className = `p-4 mb-3 rounded-xl shadow-md transition-all duration-300 ease-in-out ${room.colorClass} border-l-4`;

                const roomName = room[roomNameKey] || room.name;

                listItem.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-grow">
                            <h2 class="text-lg font-bold text-gray-800">${roomName}</h2>
                            <p class="text-sm text-gray-500">
                                ${t.floor}: ${room.floor_label} | ${t.room_id_label}: ${room.room_id} | ${t.capacity_label}: ${room.max_capacity}
                            </p>
                        </div>
                        <div class="flex-shrink-0 ml-4 text-right">
                            <p class="text-2xl font-extrabold text-gray-900">${room.percentage}%</p>
                            <p class="text-sm text-gray-600">${room.current_occupancy} ${t.people_label}</p>
                        </div>
                    </div>
                    <div class="w-full h-2 mt-3 bg-gray-200 rounded-full overflow-hidden">
                        <div
                            class="h-full rounded-full transition-all duration-500"
                            style="width: ${room.percentage}%; background-color: ${getBarColor(room.percentage)};"
                            >
                        </div>
                    </div>
                `;
                listContainer.appendChild(listItem);
            });
            if (rooms.length === 0) {
                 listContainer.innerHTML = `<div class="text-center text-gray-500 py-8">${translate('fetching_data')}</div>`;
            }
        }

        function sortRooms(optionalKey = null) {
            const dropdown = document.getElementById('sort-key-dropdown');
            const newKey = optionalKey || dropdown.value;

            if (newKey !== currentSortKey) {
                currentSortKey = newKey;
            }

            updateSortControlsUI(currentSortKey, currentSortDirection);

            currentRoomDataArray.sort((a, b) => {
                let valA, valB;

                switch (currentSortKey) {
                    case 'people':
                        valA = a.current_occupancy;
                        valB = b.current_occupancy;
                        return currentSortDirection === 'asc' ? valA - valB : valB - valA;

                    case 'percentage':
                        valA = a.percentage;
                        valB = b.percentage;
                        return currentSortDirection === 'asc' ? valA - valB : valB - valA;

                    case 'api_order':
                        valA = a.api_index;
                        valB = b.api_index;
                        return currentSortDirection === 'asc' ? valA - valB : valB - valA;

                    default:
                        return 0;
                }
            });

            renderRooms(currentRoomDataArray);
        }

        function toggleSortDirection() {
            currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            sortRooms(currentSortKey);
        }

        function updateSortControlsUI(key, direction) {
            const dropdown = document.getElementById('sort-key-dropdown');
            dropdown.value = key;

            const icon = document.getElementById('direction-icon');
            const text = document.getElementById('direction-text');

            if (direction === 'asc') {
                text.textContent = translate('direction_asc');
                icon.style.transform = 'rotate(180deg)';
            } else {
                text.textContent = translate('direction_desc');
                icon.style.transform = 'rotate(0deg)';
            }
        }

        function renderFloor(floorKey) {
            currentFloor = floorKey;
            const floorPlanData = FLOOR_PLANS[floorKey];
            const mapContainer = document.getElementById('map-container');

            if (!mapContainer) return;

            mapContainer.innerHTML = `
                <img id="floor-plan-image" src="${floorPlanData.image}" alt="${floorKey} Floor Plan" class="floor-plan" />
                <div id="room-markers"></div>
            `;

            const markerContainer = document.getElementById('room-markers');

            floorPlanData.rooms.forEach(roomConfig => {
                const roomData = currentMergedRoomData.get(roomConfig.room_id);
                if (!roomData) return;

                const marker = document.createElement('div');
                marker.className = 'room-marker';
                marker.id = `marker-${roomConfig.room_id}`;
                marker.style.left = `${roomConfig.x}%`;
                marker.style.top = `${roomConfig.y}%`;
                marker.style.backgroundColor = roomData.color;
                marker.style.setProperty('--marker-color', roomData.color);
                marker.title = `${currentLang === 'zh' ? roomData.name_zh : roomData.name} (${roomData.percentage}%)`;

                marker.addEventListener('click', () => {
                    displayRoomDetails(roomConfig.room_id);
                });

                markerContainer.appendChild(marker);
            });

            const selectedRoomId = mapContainer.dataset.selectedRoom;
            if (selectedRoomId) {
                displayRoomDetails(selectedRoomId);
            } else {
                displayRoomDetails(null);
            }
        }

        function displayRoomDetails(roomId) {
            const detailsCard = document.getElementById('room-details-card');
            const mapContainer = document.getElementById('map-container');
            const t = TRANSLATIONS[currentLang];

            if (!detailsCard || !mapContainer) return;

            document.querySelectorAll('.room-marker').forEach(m => m.classList.remove('room-marker-blink'));

            if (!roomId || !currentMergedRoomData.has(roomId)) {
                detailsCard.innerHTML = `<p class="p-6 text-center text-gray-500">${t.no_room_selected}</p>`;
                mapContainer.dataset.selectedRoom = '';
                return;
            }

            const room = currentMergedRoomData.get(roomId);
            const roomName = currentLang === 'zh' ? room.name_zh : room.name;

            const marker = document.getElementById(`marker-${roomId}`);
            if(marker) {
                 marker.classList.add('room-marker-blink');
            }

            mapContainer.dataset.selectedRoom = roomId;

            const barColor = getBarColor(room.percentage);

            detailsCard.innerHTML = `
                <div class="p-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">${roomName}</h2>

                    <div class="grid grid-cols-2 gap-y-2 mb-6 text-lg">
                        <div class="text-gray-500">${t.floor}:</div>
                        <div class="text-gray-800 font-semibold">${room.floor_label}</div>

                        <div class="text-gray-500">${t.room_id_label}:</div>
                        <div class="text-gray-800 font-semibold">${room.room_id}</div>

                        <div class="text-gray-500">${t.capacity_label}:</div>
                        <div class="text-gray-800 font-semibold">${room.max_capacity} ${t.people_label}</div>
                    </div>

                    <div class="flex flex-col space-y-3">
                        <div class="flex justify-between items-center">
                            <div class="text-xl font-medium text-gray-700">
                                ${t.current_occupancy}:
                                <span class="text-3xl font-extrabold" style="color: ${barColor};">${room.current_occupancy}</span>
                                /${room.max_capacity}
                            </div>
                            <div class="text-3xl font-extrabold text-gray-900 bg-gray-100 px-3 py-1 rounded-lg">${room.percentage}%</div>
                        </div>

                        <div class="w-full h-4 bg-gray-200 rounded-full overflow-hidden">
                            <div
                                class="h-full rounded-full transition-all duration-500"
                                style="width: ${room.percentage}%; background-color: ${barColor};"
                            ></div>
                        </div>
                    </div>
                </div>
            `;
            const detailsSection = document.getElementById('floor-view-container').querySelector('.shadow-2xl');
            if (detailsSection) {
                detailsSection.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        }

        function toggleView(view) {
            currentView = view;
            const listContainer = document.getElementById('list-view-container');
            const floorContainer = document.getElementById('floor-view-container');
            const listControls = document.getElementById('list-view-controls');
            const floorControls = document.getElementById('floor-view-controls');

            const headerTitle = document.getElementById('header-title');
            const headerSubtitle = document.getElementById('header-subtitle');
            headerTitle.textContent = translate(view === 'list' ? 'title_list' : 'title_floor');
            headerSubtitle.textContent = translate(view === 'list' ? 'subtitle_list' : 'subtitle_floor');

            if (view === 'list') {
                listContainer.classList.remove('hidden');
                listControls.classList.remove('hidden');
                floorContainer.classList.add('hidden');
                floorControls.classList.add('hidden');
                document.getElementById('list-view-toggle-button').classList.add('active');
                document.getElementById('floor-view-toggle-button').classList.remove('active');
                sortRooms(currentSortKey);
            } else {
                listContainer.classList.add('hidden');
                listControls.classList.add('hidden');
                floorContainer.classList.remove('hidden');
                floorControls.classList.remove('hidden');
                document.getElementById('list-view-toggle-button').classList.remove('active');
                document.getElementById('floor-view-toggle-button').classList.add('active');
                renderFloor(currentFloor);
            }
        }

        function prepareDataStructures() {
            const floorPlansMap = new Map();
            FLOOR_PLANS_RAW.forEach(floor => {
                floorPlansMap.set(floor.key, {
                    label: floor.label_en,
                    image: floor.image_url,
                    rooms: ROOM_CONFIG.filter(r => r.floor_label === floor.key),
                });
            });
            FLOOR_PLANS = Object.fromEntries(floorPlansMap);

            FLOOR_PLANS_RAW.forEach(floor => {
                TRANSLATIONS['en'][`floor_${floor.key}`] = floor.label_en;
                TRANSLATIONS['zh'][`floor_${floor.key}`] = floor.label_zh;
            });

            const floorDropdown = document.getElementById('floor-dropdown');
            floorDropdown.innerHTML = '';
            FLOOR_PLANS_RAW.forEach(floor => {
                const option = document.createElement('option');
                option.value = floor.key;
                option.textContent = translate(`floor_${floor.key}`);
                if (floor.key === currentFloor) {
                    option.selected = true;
                }
                floorDropdown.appendChild(option);
            });
        }

        function setLanguage() {
            const newLang = document.getElementById('lang-dropdown').value;
            if (TRANSLATIONS[newLang]) {
                currentLang = newLang;

                toggleView(currentView);
                document.getElementById('refresh-button-text').textContent = translate('refresh_data');
                document.getElementById('loading-indicator').textContent = translate('loading');

                document.getElementById('floor-view-button-text').textContent = translate('floor_view_mode');
                document.getElementById('list-view-button-text').textContent = translate('list_view_mode');

                document.getElementById('sort-by-label').textContent = translate('sort_by');
                document.querySelector('#sort-key-dropdown option[value="api_order"]').textContent = translate('option_default');
                document.querySelector('#sort-key-dropdown option[value="percentage"]').textContent = translate('option_percentage');
                document.querySelector('#sort-key-dropdown option[value="people"]').textContent = translate('option_people');
                updateSortControlsUI(currentSortKey, currentSortDirection);

                document.getElementById('floor-select-label').textContent = translate('select_floor');
                document.getElementById('details-title').textContent = translate('room_details');

                const floorDropdown = document.getElementById('floor-dropdown');
                Array.from(floorDropdown.options).forEach(option => {
                    const floorKey = option.value;
                    option.textContent = translate(`floor_${floorKey}`);
                });

                if (currentView === 'list') {
                    renderRooms(currentRoomDataArray);
                } else {
                    renderFloor(currentFloor);
                    const selectedRoomId = document.getElementById('map-container').dataset.selectedRoom;
                    displayRoomDetails(selectedRoomId);
                }
            }
        }

        async function refreshData() {
            const refreshButton = document.getElementById('refresh-button');
            const loadingIndicator = document.getElementById('loading-indicator');
            const listContainer = document.getElementById('room-list');
            const mapContainer = document.getElementById('map-container');

            refreshButton.disabled = true;
            loadingIndicator.classList.remove('hidden');

            const loadingMessage = `<div class="text-center text-gray-500 py-8">${translate('fetching_data')}</div>`;

            if (currentView === 'list') {
                listContainer.innerHTML = loadingMessage;
            } else {
                 mapContainer.innerHTML = loadingMessage;
                 document.getElementById('room-details-card').innerHTML = `<p class="p-6 text-center text-gray-500">${translate('no_room_selected')}</p>`;
            }

            try {
                const occupancyData = await fetchOccupancyData();
                mergeData(occupancyData);
            } catch (error) {
                const errorMessage = `<div class="text-center text-red-500 py-8 font-semibold">${translate('error_loading')}</div>`;
                if (currentView === 'list') {
                    listContainer.innerHTML = errorMessage;
                } else {
                    mapContainer.innerHTML = errorMessage;
                }
            } finally {
                refreshButton.disabled = false;
                loadingIndicator.classList.add('hidden');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            prepareDataStructures();
            setLanguage();
            toggleView('list');

            document.getElementById('sort-key-dropdown').addEventListener('change', () => { sortRooms(); });
            document.getElementById('sort-direction-toggle').addEventListener('click', toggleSortDirection);

            document.getElementById('floor-dropdown').addEventListener('change', (e) => {
                renderFloor(e.target.value);
            });

            document.getElementById('lang-dropdown').addEventListener('change', setLanguage);
            document.getElementById('refresh-button').addEventListener('click', refreshData);
            document.getElementById('list-view-toggle-button').addEventListener('click', () => toggleView('list'));
            document.getElementById('floor-view-toggle-button').addEventListener('click', () => toggleView('floor'));

            refreshData();
        });
    </script>
</head>
<body class="p-4 sm:p-6 min-h-screen">

    <div class="max-w-4xl mx-auto">

        <header class="mb-6 border-b pb-4 flex justify-between items-start">
            <div>
                <h1 id="header-title" class="text-3xl font-extrabold text-gray-900 mb-1">Live Occupancy Monitor</h1>
                <p id="header-subtitle" class="text-gray-500">Real-time room capacity status. Click refresh to update.</p>
            </div>

            <div class="flex flex-col space-y-2 sm:space-y-0 sm:flex-row sm:space-x-3 items-end">
                <div class="flex space-x-2">
                    <button id="list-view-toggle-button" class="view-toggle-button active">
                        <svg class="w-4 h-4 mr-1.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="8" y1="6" x2="21" y2="6"></line>
                            <line x1="8" y1="12" x2="21" y2="12"></line>
                            <line x1="8" y1="18" x2="21" y2="18"></line>
                            <line x1="3" y1="6" x2="3.01" y2="6"></line>
                            <line x1="3" y1="12" x2="3.01" y2="12"></line>
                            <line x1="3" y1="18" x2="3.01" y2="18"></line>
                        </svg>
                        <span id="list-view-button-text">List View</span>
                    </button>
                    <button id="floor-view-toggle-button" class="view-toggle-button">
                        <svg class="w-4 h-4 mr-1.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M2 17l10 5 10-5M2 12l10 5 10-5M12 2v20"/>
                        </svg>
                        <span id="floor-view-button-text">Floor View</span>
                    </button>
                </div>

                <select id="lang-dropdown" class="text-sm font-semibold rounded-xl px-3 py-2 border border-gray-300 text-gray-800 bg-white shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200">
                    <option value="en">English</option>
                    <option value="zh">中文</option>
                </select>
            </div>
        </header>

        <div id="dynamic-controls" class="flex flex-col sm:flex-row justify-between items-center mb-6 space-y-4 sm:space-y-0">
             <div id="list-view-controls" class="flex space-x-2 w-full sm:w-auto items-center hidden">
                <span id="sort-by-label" class="text-sm font-medium text-gray-600 self-center hidden sm:block">Sort By:</span>

                <select id="sort-key-dropdown" class="text-sm font-semibold rounded-xl px-3 py-2 border border-indigo-600 text-indigo-800 bg-white shadow-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200">
                    <option value="api_order" selected>Default</option>
                    <option value="percentage">% Full</option>
                    <option value="people">People</option>
                </select>

                <button id="sort-direction-toggle" class="text-sm font-semibold rounded-xl px-3 py-2 border border-indigo-600 bg-indigo-600 text-white transition duration-200 flex items-center shadow-md hover:bg-indigo-700" aria-label="Toggle sort direction">
                    <span id="direction-text">Ascending</span>
                    <svg id="direction-icon" class="w-4 h-4 ml-2 transition-transform duration-300 transform rotate-180" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>

            <div id="floor-view-controls" class="flex space-x-2 w-full sm:w-auto items-center hidden">
                <span id="floor-select-label" class="text-sm font-medium text-gray-600 self-center">Select Floor:</span>

                <select id="floor-dropdown" class="text-sm font-semibold rounded-xl px-3 py-2 border border-indigo-600 text-indigo-800 bg-white shadow-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200">
                </select>
            </div>

            <div class="flex items-center space-x-2 w-full sm:w-auto">
                <button id="refresh-button" class="flex items-center justify-center bg-indigo-500 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-xl transition duration-200 shadow-lg w-full sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21.5 2v6h-6"/>
                        <path d="M2.5 22v-6h6"/>
                        <path d="M2.5 13a9 9 0 0 1 15.6-6.6l3.4-3.4"/>
                        <path d="M21.5 11a9 9 0 0 1-15.6 6.6l-3.4 3.4"/>
                    </svg>
                    <span id="refresh-button-text">Refresh Data</span>
                </button>
                <span id="loading-indicator" class="hidden text-sm font-medium text-indigo-600">
                    Loading...
                </span>
            </div>
        </div>

        <div id="list-view-container" class="mt-8">
            <div id="room-list">
                <div class="text-center text-gray-500 py-8">Loading initial data...</div>
            </div>
        </div>

        <div id="floor-view-container" class="hidden">
            <div id="map-container" class="floor-plan-container mb-8" data-selected-room="">
                <div class="text-center text-gray-500 py-8">Loading floor plan...</div>
            </div>

            <div class="bg-white rounded-xl shadow-2xl border border-gray-200">
                <h3 id="details-title" class="text-xl font-bold text-gray-800 p-4 border-b">Room Details</h3>
                <div id="room-details-card" class="min-h-[100px] flex items-center justify-center">
                    <p class="p-6 text-center text-gray-500">Click on a room marker on the map to see its details.</p>
                </div>
            </div>
        </div>

    </div>

</body>
</html>
